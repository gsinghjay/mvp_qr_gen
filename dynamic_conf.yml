# Dynamic configuration (dynamic_conf.yml)
http:
  routers:
    api-router:
      rule: "PathPrefix(`/`) && !PathPrefix(`/kc`)"
      service: api-service
      entryPoints:
        - web
      middlewares:
        - redirect-to-https
      priority: 10

    api-secure-router:
      rule: "PathPrefix(`/`) && !PathPrefix(`/kc`)"
      service: api-service
      entryPoints:
        - websecure
      tls: {}
      priority: 10
      
    keycloak-router:
      rule: "PathPrefix(`/kc`)"
      service: keycloak-service
      entryPoints:
        - web
        - websecure
      middlewares:
        - redirect-to-https
        - keycloak-headers
      tls: {}
      priority: 100

    dashboard:
      rule: "Host(`traefik.localhost`)"
      service: api@internal
      entryPoints:
        - traefik

  middlewares:
    redirect-to-https:
      redirectScheme:
        scheme: https
        permanent: true
        
    keycloak-headers:
      headers:
        customRequestHeaders:
          X-Forwarded-Proto: "https"
        stsSeconds: 31536000
        stsIncludeSubdomains: true
        forceSTSHeader: true
        contentSecurityPolicy: "frame-ancestors 'self'; frame-src 'self'; object-src 'none';"
        customFrameOptionsValue: "SAMEORIGIN"

  services:
    api-service:
      loadBalancer:
        servers:
          - url: "http://qr_generator_api:8000"
          
    keycloak-service:
      loadBalancer:
        servers:
          - url: "http://keycloak:8080" 