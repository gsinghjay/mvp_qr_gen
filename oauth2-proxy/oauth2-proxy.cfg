## OAuth2 Proxy Config File

# OAuth provider - use keycloak-oidc for better group support
provider = "keycloak-oidc"

# HTTP Settings
http_address = "0.0.0.0:4180"
upstreams = ["http://api:8000"]

# OIDC Settings
client_id = "oauth2-proxy-client"
client_secret = "ClSY92yp1zMOGTnjhZWF6E6uN7uU7fYX"
redirect_url = "https://web.hccc.edu/oauth2/callback"
oidc_issuer_url = "https://auth.hccc.edu/realms/hccc-apps-realm"
skip_provider_button = true
skip_oidc_discovery = true
login_url = "https://auth.hccc.edu/realms/hccc-apps-realm/protocol/openid-connect/auth"
redeem_url = "http://keycloak_service:8080/realms/hccc-apps-realm/protocol/openid-connect/token"
oidc_jwks_url = "http://keycloak_service:8080/realms/hccc-apps-realm/protocol/openid-connect/certs"
insecure_oidc_allow_unverified_email = true
ssl_insecure_skip_verify = true

# Security Enhancement - PKCE (Proof Key for Code Exchange)
code_challenge_method = "S256"

# Scope - Remove groups scope to avoid Azure AD errors (AADSTS650053)
scope = "openid email profile"

# Group Configuration - Groups come through claims from Azure AD via Keycloak mappers
oidc_groups_claim = "groups"

# Authorization Configuration (COMMENTED OUT - Enable after groups client scope setup)
# allowed_group = "constituency-students"
# allowed_group = "constituency-facultystaff"
# Alternative role-based authorization:
# allowed_role = "student-role"
# allowed_role = "faculty-role"

# Logout Settings - Updated to support domain-based internal access
whitelist_domains = "web.hccc.edu,webhost.hccc.edu,auth.hccc.edu"

# Cookie Settings - Updated to use hostname instead of IP
cookie_name = "_oauth2_proxy"
cookie_secret = "TW3nKB3ZeCtdj6jAT+QoOhIexkjPtJPY"
cookie_domains = "web.hccc.edu,webhost.hccc.edu"
cookie_secure = false
cookie_httponly = true

# Email Settings
email_domains = "*"

# Request Headers - Enhanced for OIDC logout with token access and group support
set_xauthrequest = true
pass_access_token = true
pass_user_headers = true
set_authorization_header = true
pass_authorization_header = true
skip_auth_strip_headers = false  